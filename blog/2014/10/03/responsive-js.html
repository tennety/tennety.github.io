<!DOCTYPE html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset='UTF-8'>
  <meta content='' name='description'>
  <meta content='' name='copyright'>
  <link href='/humans.txt' rel='author' type='text/plain'>
  <meta content='width=device-width, initial-scale=1.0' name='viewport'>
  <meta content='true' name='HandheldFriendly'>
  <meta content='320' name='MobileOptimized'>
  <meta content='yes' name='apple-mobile-web-app-capable'>
  <meta content='black-translucent' name='apple-mobile-web-app-status-bar-style'>
  <meta content='on' http-equiv='cleartype'>
  <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
  <title>Responsive JavaScript With EnquireJS</title>
  <link href="/stylesheets/application.css" media="screen" rel="stylesheet" type="text/css" />
  
  <!-- IE backporting -->
  <!--[if lt IE 9]>
  <script src="/javascripts/html5.js" type="text/javascript"></script>
  <![endif]-->
  
</head>
<body>
  <div class='sticky'>
    <nav class='top-bar home-border'>
      <ul class='title-area'>
        <li class='name'>
          <h1>
            <a href="/">Chandu Tennety</a>
          </h1>
        </li>
        <li class='toggle-topbar menu-icon'>
          <a href=''>
            <span></span>
          </a>
        </li>
      </ul>
      <section class='top-bar-section'>
        <ul class='left'>
          <li>
            <a href='/blog'>Blog</a>
          </li>
          <li>
            <a href='/resume.html'>Resume</a>
          </li>
          <li>
            <a href='https://github.com/tennety' target='_blank'>
              <i class='icon-github-alt'></i>
            </a>
          </li>
          <li>
            <a href='https://twitter.com/tennety' target='_blank'>
              <i class='icon-twitter'></i>
            </a>
          </li>
          <li>
            <a href='mailto:chandu.tennety+blog@gmail.com' target='_blank'>
              <i class='icon-envelope-alt'></i>
            </a>
          </li>
        </ul>
      </section>
    </nav>
  </div>
  <div class='row'>
    <div class='small-12 columns'>
      <div class='row'>
        <article class='small-9 columns'>
          <h1>
            Responsive JavaScript With EnquireJS
          </h1>
          <p>For a dynamic client-side application, using CSS alone to show and hide components for different screen sizes isn't enough. Even when hidden, components may be listening for application state and re-rendering themselves or taking up resources for no visible effect, giving the perception of a laggy app. They may be making unnecessary AJAX requests to the server.</p>
          
          <h3 id="screen-size-as-application-state">Screen size as application state</h3>
          
          <p>The client environment needs to be aware of the available screen size at a more
          fundamental level. In other words, screen size should be part of the
          application state. This way, the client can make decisions on whether or not to
          render certain components for a given screen size.</p>
          
          <h2 id="enquirejs">EnquireJS</h2>
          
          <p>It would be great to have a way to make media queries from the client code, and
          be notified when the screen size changes.
          <a href="http://wicky.nillia.ms/enquire.js/">EnquireJS</a> is a lightweight library that
          makes it easy to do this, using the
          <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.matchMedia"><code>window.matchMedia</code></a>
          API and a simple registry/callback pattern that fires for different stages of
          matching a media query. We can use enquirejs callbacks to set the value of a
          <code>screen-size</code> variable, which our app can use when deciding whether or not to render a
          component. In the following ClojureScript example, <code>model</code> is an atom that is responsible for the
          application state:</p>
          
          <pre class="highlight clojure"><table><tbody><tr><td class="gutter gl"><div class="lineno">1</div><div class="lineno">2</div><div class="lineno">3</div><div class="lineno">4</div><div class="lineno">5</div><div class="lineno">6</div><div class="lineno">7</div><div class="lineno">8</div><div class="lineno">9</div></td><td class="code"><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">update-size</span><span class="w"> </span><span class="p">[</span><span class="n">model</span><span class="w"> </span><span class="n">new-size</span><span class="p">]</span><span class="w">
            </span><span class="p">(</span><span class="k">fn</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">(</span><span class="nf">swap!</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="nb">assoc</span><span class="w"> </span><span class="no">:screen-size</span><span class="w"> </span><span class="n">new-size</span><span class="p">)))</span><span class="w">
          </span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">watch-screen-size</span><span class="w"> </span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="w">
            </span><span class="p">(</span><span class="nb">-&gt;</span><span class="w"> </span><span class="n">js/enquire</span><span class="w">
                </span><span class="p">(</span><span class="nf">.register</span><span class="w"> </span><span class="s">&quot;screen and (min-width: 0px) and (max-width: 520px)&quot;</span><span class="w">    </span><span class="p">(</span><span class="nf">update-size</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="s">&quot;xs&quot;</span><span class="p">))</span><span class="w">
                </span><span class="p">(</span><span class="nf">.register</span><span class="w"> </span><span class="s">&quot;screen and (min-width: 521px) and (max-width: 768px)&quot;</span><span class="w">  </span><span class="p">(</span><span class="nf">update-size</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="s">&quot;sm&quot;</span><span class="p">))</span><span class="w">
                </span><span class="p">(</span><span class="nf">.register</span><span class="w"> </span><span class="s">&quot;screen and (min-width: 769px) and (max-width: 1024px)&quot;</span><span class="w"> </span><span class="p">(</span><span class="nf">update-size</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="s">&quot;md&quot;</span><span class="p">))</span><span class="w">
                </span><span class="p">(</span><span class="nf">.register</span><span class="w"> </span><span class="s">&quot;screen and (min-width: 1025px)&quot;</span><span class="w">                        </span><span class="p">(</span><span class="nf">update-size</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="s">&quot;lg&quot;</span><span class="p">))))</span><span class="w">
          </span></td></tr></tbody></table></pre>
          <p>Now, by running <code>watch-screen-size</code> at startup, we can check the value of the
          <code>screen-size</code> variable before rendering a component, making an AJAX call, or
          even deciding which URL to call. The server API can be made smart about having
          different endpoints with appropriate payloads based on the screen size.</p>
          
          <h3 id="heres-an-example">Here's an example</h3>
          
          <p>The above code snippet was taken from an app that needs to display an SVG
          county map of the United States using D3 (look
          <a href="http://neo.com/2014/04/21/choropleths-and-d3js">here</a> for more on that). The
          county map contains over 3000 SVG elements, so it rendered and updated
          painfully slowly on devices such as tablets or phones. We used CSS to scale the
          SVG to fit the screen better, but we had to find a quicker, more efficient way
          to display the map details.</p>
          
          <p>Having a handle on the <code>screen-size</code> variable allowed us to do that. Instead of
          rendering the county map, we now render a state map for smaller screens. This
          brought the number of data points down by orders of magnitude, making the
          render much more snappy.</p>
          
          <p>The data to be displayed on the map also changes based on a selected month. On
          larger screens, this month selector appears as a slider, but on smaller screens
          we render a simple select list instead. We could render them both all the time
          and selectively shown one over the other, but knowing the screen size allows us
          to not have to do that.</p>
          
          <h2 id="conclusion">Conclusion</h2>
          
          <p>Media queries with CSS can only take you so far. For a static site that doesn't
          make a lot of AJAX calls, this may be all you need. But with a rich client-side
          application, knowing the size of your user's screen is as valuable as any other
          user input that your app can react to.</p>
          <ul class='read_next'>
            <li><a href="/blog/2014/09/22/announcing-birdwave.html">&laquo; Announcing Birdwave</a></li>
            <li><a href="/blog/2014/11/17/cljs-om-walkthrough.html">Adding a Component to a ClojureScript/Om Application &mdash; a Walkthrough &raquo;</a></li>
          </ul>
          <div id='disqus_thread'>
            <script type='text/javascript'>
              var disqus_shortname = 'tennety';
              (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
            </script>
            <noscript>
              Please enable JavaScript to view the
              <a href="http://disqus.com/?ref_noscript">comments powered by Disqus</a>
            </noscript>
            <a class='dsq-brlink' href='http://disqus.com'>
              <span class='logo-disqus'>Disqus</span>
            </a>
          </div>
        </article>
        <aside class='small-3 columns'>
          <ul class='credit'>
            <li><a class="tiny button secondary round" href="/blog/tags/tech.html">tech</a></li>
            <li><a class="tiny button secondary round" href="/blog/tags/javascript.html">JavaScript</a></li>
            <li><a class="tiny button secondary round" href="/blog/tags/clojurescript.html">ClojureScript</a></li>
            <li><a class="tiny button secondary round" href="/blog/tags/responsive.html">responsive</a></li>
          </ul>
        </aside>
      </div>
    </div>
  </div>
  <footer class='row'>
    <!--[if lt IE 8]>
    <div id="ie-warning-overlay">
    <div id="ie-warning">
    <h1>Did you know that your copy of Internet Explorer is out of date?</h1>
    <p>
    To get the best possible experience using our website, we recommend that you upgrade to the latest version or use another web browser.
    Any of the following will provide a superior experience, not only on this site, but across the web.
    </p>
    <p>Just click one of the icons below to get to the download page.</p>
    <ul>
    <li>
    <a href="http://microsoft.com/ie">
    <%= image_tag 'browser_ie.gif', :alt => "Download Internet Explorer" %>
    <p>Internet Explorer 8+</p>
    </a>
    </li>
    <li>
    <a href="http://mozilla.org/firefox">
    <%= image_tag 'browser_firefox.gif', :alt => "Download Firefox" %>
    <p>Firefox</p>
    </a>
    </li>
    <li>
    <a href="http://google.com/chrome">
    <%= image_tag 'browser_chrome.gif', :alt => "Download Chrome" %>
    <p>Google Chrome</p>
    </a>
    </li>
    <li>
    <a href="http://apple.com/safari">
    <%= image_tag 'browser_safari.gif', :alt => "Download Safari" %>
    <p>Safari</p>
    </a>
    </li>
    <li>
    <a href="http://opera.com">
    <%= image_tag 'browser_opera.gif', :alt => "Download Opera" %>
    <p>Opera</p>
    </a>
    </li>
    </ul>
    </div>
    </div>
    <![endif]-->
  </footer>
  <!-- jQuery -->
  <script src='//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js'></script>
  <script>
    window.jQuery || document.write('<script src="/jquery.js"><\/script>');
  </script>
  <!-- Javascript -->
  <script src="/javascripts/application.js" type="text/javascript"></script>
  
  <script type='text/javascript'>
    $(document).ready(function () {
    imgSizer.collate();
    
    });
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-46441071-1', 'tennety.github.io');
    ga('send', 'pageview');
  </script>
</body>


